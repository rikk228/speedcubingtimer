window.onload=loading;const maincontainer=document.querySelector("#main-content");maincontainer.addEventListener("keyup",startTimer),maincontainer.addEventListener("keydown",startAnimation),maincontainer.addEventListener("touchend",startTimer),maincontainer.addEventListener("touchstart",startAnimation),maincontainer.focus();const timer=document.querySelector("#timer"),generatedMoves=document.querySelector("#generatedMoves"),statscontainer=document.querySelector("#stats-table");let orderAttemptbtn=document.querySelector("#order-by-attemptno");orderAttemptbtn.addEventListener("click",orderByAttemptNo);let orderTimebtn=document.querySelector("#order-by-time");orderTimebtn.addEventListener("click",ordereByTime);const sidebar=document.querySelector("#sidebar"),titleContainer=document.querySelector("#title-container"),lastGen=document.querySelector("#lastGen");lastGen.addEventListener("click",displayLastGen);const regenerateGen=document.querySelector("#reGen");regenerateGen.addEventListener("click",regenerateNewGen);const generator=document.querySelector("#sec-container > div.generator");let data;localStorage.getItem("attempts")||setDefaultAttempts(),appendAllStats(JSON.parse(localStorage.getItem("attempts")).attempts),localStorage.getItem("gens")||setDefaultGens(),localStorage.getItem("currentGen")||setDefaultCurrentGen();let icons={squareUp:'<i class="fas fa-caret-square-up"></i>',squareDown:'<i class="fas fa-caret-square-down"></i>'},startingTime,isActive=!1,intervall,number=55,colorIntervall,timeIntervall=100,started=!1,colorTimeout,scrambleArr=[];function startTimer(a){if("touchend"===a.type&& !a.target.id.includes("timer")&&"sec-container"!==a.target.id||"keyup"===a.type&&"Space"!==a.code)return;if("starting"===timer.classList[0]){clearTimeout(colorTimeout),removeDNShowClass(),timer.className="",started=!1;return}if(("Space"===a.code||"touchend"===a.type)&&!isActive){isActive=!isActive,number=0,startingTime=new Date,intervall=setInterval(updateTimer,timeIntervall);return}let d=new Date;clearInterval(intervall);let e=getMMSSMS((d-startingTime)/1e3,!0);timer.textContent=e;let b=JSON.parse(localStorage.getItem("attempts")),c={attemptNo:b.attempt,time:e,ms:(d-startingTime)/1e3,scrambleSequence:getCurrentGen()};b.attempts.push(c),b.attempt+=1,appendStatsTable({attemptNo:c.attemptNo,time:c.time}),localStorage.setItem("attempts",JSON.stringify(b)),scrambleArr=[],generateScramble(),isActive=!isActive,number=0}function updateTimer(){number+=timeIntervall,timer.textContent=getMMSSMS(number/1e3,!1)}function getMMSSMS(a,e){let b,c,d;return b="."+(a%1).toFixed(1).substring(2),e&&(b="."+(a%1).toFixed(3).substring(2)),c=":"+Math.floor(a)%60,Math.floor(a)%60<10&&(c=":0"+Math.floor(a)%60),d=Math.floor(a/60)%60,d+c+b}function startAnimation(a){if(!a.repeat){if(!a.code&&"touchstart"===a.type&&!started&&a.target.id.includes("timer")||"Space"===a.code&&!started)return void(sidebar.className=sidebar.className+" dnShow",titleContainer.className=titleContainer.className+" dnShow",generator.className+=" dnShow",maincontainer.className=maincontainer.className+" fullScreen",timer.className="starting",started=!0,colorTimeout=setTimeout(()=>{timer.className="start"},1200));started=!1,removeDNShowClass()}}function generateScramble(){for(let a=0;a<25;a++)scrambleArr.push(generateMove());for(let b=0;b<25;b++)checkScramble();let c=scrambleArr.join(" ");pushNewGen(c),setCurrentGen(c),updateScrambleDisplay()}function checkScramble(){for(let a=1;a<scrambleArr.length;a++){let b=scrambleArr[a],c=scrambleArr[a-1];(c+"'"===b||b+"'"===c)&&(scrambleArr[a]=generateMove(),scrambleArr[a-1]=generateMove()),b===c&&(scrambleArr[a]=b.replace("'","")+"2",scrambleArr.splice(a-1,1))}}function generateMove(){let a=Math.floor(Math.random()*data.length);return data[a].abb}async function loading(){data=await fetch("/moveNames.json").then(a=>a.json()),isTouchDevice()&&(timer.textContent="Tap & Hold Here"),generateScramble()}function appendAllStats(b){for(let a=0;a<b.length;a++)appendStatsTable(b[a])}function appendStatsTable({attemptNo:a,time:c}){a+=1;let b=`<tr class="stats" id="stats- attemptNo ">
    <th> attemptNo </th>
    <th> time </th>
    <th> <button aria-label="delete attempt" class="info-icon btn-with-icon" id="delete- attemptNo " type="button"><i class="fas fa-trash-alt"></i></button>   <button aria-label="get more info about a specific attempt" class="info-icon btn-with-icon" id="more- attemptNo " type="button"><i class="fas fa-info-circle"></i></button></th>
    </tr>`;b=b.replace(" attemptNo ",a).replace(" time ",c).replace(" attemptNo ",a).replace(" attemptNo ",a).replace(" attemptNo ",a),statscontainer.insertAdjacentHTML("beforeend",b),document.querySelector(`#delete-${a}`).addEventListener("click",deleteStatsRow),document.getElementById(`more-${a}`).addEventListener("click",displayModal)}let isAscendingAttempt=!1;function orderByAttemptNo(d){let a=JSON.parse(localStorage.getItem("attempts")).attempts;if(clearStatsTable(),isAscendingAttempt){appendAllStats(a),isAscendingAttempt=!1,orderAttemptbtn.innerHTML=icons.squareUp;return}isAscendingAttempt=!0;let c=[];for(let b=a.length-1;b>=0;b--)c.push(a[b]);orderAttemptbtn.innerHTML=icons.squareDown,appendAllStats(c)}let isAscendingTime=!1;function ordereByTime(c){let a=JSON.parse(localStorage.getItem("attempts")).attempts;clearStatsTable();let b=a.sort((a,b)=>b.ms-a.ms);if(isAscendingTime){appendAllStats(b=a.sort((a,b)=>a.ms-b.ms)),isAscendingTime=!1,orderTimebtn.innerHTML=icons.squareUp;return}isAscendingTime=!0,orderTimebtn.innerHTML=icons.squareDown,appendAllStats(b)}function clearStatsTable(){let a=document.querySelector("#stats-table");for(;1!=a.children.length;)a.lastChild.remove()}function deleteStatsRow(d){let c=this.id.replace("delete-","")-1,a=JSON.parse(localStorage.getItem("attempts"));for(let b=0;b<a.attempts.length;b++)a.attempts[b].attemptNo===c&&a.attempts.splice(b,1);if(this.parentElement.parentElement.remove(),0===a.attempts.length)return setDefaultAttempts();localStorage.setItem("attempts",JSON.stringify(a))}function setDefaultAttempts(){localStorage.setItem("attempts",JSON.stringify({attempts:[],attempt:0}))}function removeDNShowClass(){let a=sidebar.className.split(" ");for(let b=0;b<a.length;b++)"dnShow"===a[b]&&a.splice(b,1);let c=titleContainer.className.split(" ");for(let d=0;d<c.length;d++)"dnShow"===c[d]&&c.splice(d,1);let e=generator.className.split(" ");for(let f=0;f<e.length;f++)"dnShow"===e[f]&&e.splice(f,1);sidebar.className=a,titleContainer.className=c,generator.className=e;let g=maincontainer.className.split(" ");for(let h=0;h<g.length;h++)"fullScreen"===g[h]&&g.splice(h,1);maincontainer.className=g}function displayLastGen(f){let d=localStorage.getItem("currentGen"),a=JSON.parse(localStorage.getItem("gens")),c=0;for(let b=0;b<a.length;b++){let e=a[b];if(e===d&&b-1>0){c=b-1;break}}a.splice(c+1),localStorage.setItem("gens",JSON.stringify(a)),setCurrentGen(a[c]),updateScrambleDisplay()}function updateScrambleDisplay(){let a=localStorage.getItem("currentGen");generatedMoves.textContent=a}function setDefaultGens(){localStorage.setItem("gens",JSON.stringify([]))}function setCurrentGen(a){localStorage.setItem("currentGen",a)}function pushNewGen(b){let a=JSON.parse(localStorage.getItem("gens"));a.push(b),localStorage.setItem("gens",JSON.stringify(a))}function getCurrentGen(){let a=JSON.parse(localStorage.getItem("gens"));return a[a.length-1]}function setDefaultCurrentGen(){localStorage.setItem("currentGen","")}function regenerateNewGen(a){scrambleArr=[],generateScramble()}const modal=document.getElementById("attempModal");modal.onclick=displayModal;const span=document.getElementsByClassName("close")[0];function displayModal(a){if(!a.srcElement.parentElement.id.startsWith("more"))return;let b=a.srcElement.parentElement.id.split("-")[1],c=JSON.parse(localStorage.getItem("attempts")).attempts[b-1];console.log();let d=`
    <div class="modal-content">
        <span class="close"></span>
        <h2>Attempt no. ${b}</h2>
        <h3>Time: ${c.time}</h3>
        <h3>Scramble sequence: ${c.scrambleSequence}</h3>
    </div>`;modal.innerHTML=d,modal.style.display="flex"}function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}span.onclick=function(){modal.style.display="none"},window.onclick=function(a){a.target==modal&&(modal.style.display="none")}